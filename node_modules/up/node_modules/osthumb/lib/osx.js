
/**
 * Module dependencies.
 */

var exec = require('child_process').exec
  , command = require('shelly')
  , uid = require('uid2');

/**
 * qlpreview(1).
 */

var bin = __dirname + '/../bin/qlpreview';

/**
 * OSX implementation with qlpreview.
 */

module.exports = function(path, options, fn){
  options = options || {};
  var w = options.width || 600;
  var h = options.height || 600;
  var t = options.type || 'png';
  var tmp = '/tmp/' + uid(10) + '.' + t;
  var cmd = command('? -imageType ? -maxWidth ? -maxHeight ? -inPath ? -outPath ?',
    bin, t, w, h, path, tmp);

  exec(cmd, function(err){
    if (err) return fn(err);
    fn(null, tmp);
  });
};
